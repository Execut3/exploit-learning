This section will cover exploiting provided binary which have format-string vulnerability.

### Gathering Info
First we need to gather some info about file, here are output of some commands:

```bash
$ file cookie-monster 
cookie-monster: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=998281a5f422a675de8dde267cefad19a8cef519, not stripped
```
From `file` command result, now we know that it's a 32bit elf binary.

Now checksec:

```bash
$ checksec --file=cookie-monster 
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable	FILE
Partial RELRO   Canary found      NX enabled    No PIE          No RPATH   No RUNPATH   74) Symbols	  No	0	2cookie-monster

```
which will tell us that `Canary` is enabled for this binary.

Now let's try to run this file in IDE and see what we can find. We will use `ida pro 7` to decompile and look into this binary.

```C
int __cdecl main(int argc, const char **argv, const char **envp)
{
  setbuf(stdin, 0);
  setbuf(stdout, 0);
  bakery(&argc);
  return 0;
}

unsigned int bakery()
{
  char s[32]; // [esp+Ch] [ebp-2Ch] BYREF
  unsigned int v2; // [esp+2Ch] [ebp-Ch]

  v2 = __readgsdword(0x14u);
  printf("Enter your name: ");
  fgets(s, 32, stdin);
  printf("Hello ");
  printf(s);
  puts("Welcome to the bakery!\n\nCurrent menu:");
  system("cat cookies.txt");
  puts("\nWhat would you like to purchase?");
  fgets(s, 64, stdin);
  puts("Have a nice day!");
  return __readgsdword(0x14u) ^ v2;
}
```

### Vulnerability
checking the decompiled code, we will see there are following bugs:

- `printf(s)` has format-string bug.
- `s` variable is defined 32 byte, but in line `fgets(s, 64, stdin)` it is receiving more bytes which will lead to traditional BOF bug too.
- There is canary enabled for this binary file, so normal BOF or actions to read on buffer, will lead to seg fault and canary error.

